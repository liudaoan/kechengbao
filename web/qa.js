var data = [{"QuestionNo":"1","Ask":{"UserID":"12330285","Date":"2015-04-27 13:05:39.187001666 +0800 HKT","Text":""},"Anwser":[{"UserID":"12330285","Date":"2015-04-27 17:34:20.979563666 +0800 HKT","Text":"heyæˆ‘çš„ä¸–ç•Œé‡Œæœ‰å¾ˆå¤šäººæ¥æ¥å¾€å¾€ï¼Œæœ‰çš„äººæ¨ç€æˆ‘å‰è¿›ï¼Œæœ‰çš„äººé˜»ç¢æˆ‘çš„è„šæ­¥ï¼Œæœ‰çš„äººå†·æ¼ æ—è§‚ã€‚æˆ‘å¸Œæœ›æœ‰ä¸€å¤©ï¼Œæˆ‘å¯ä»¥ä¸å¿µä»–äººï¼Œåªé—®å†…å¿ƒï¼Œåœ¨æˆ‘çš„ä¸–ç•Œé‡Œæ‚ æ¸¸è‡ªåœ¨ã€‚!"},{"UserID":"12330285","Date":"2015-04-27 17:34:58.691924619 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-27 17:36:17.53580219 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"heyheyæˆ‘çš„ä¸–ç•Œé‡Œæœ‰å¾ˆå¤šäººæ¥æ¥å¾€å¾€ï¼Œæœ‰çš„äººæ¨ç€æˆ‘å‰è¿›ï¼Œæœ‰çš„äººé˜»ç¢æˆ‘çš„è„šæ­¥ï¼Œæœ‰çš„äººå†·æ¼ æ—è§‚ã€‚æˆ‘å¸Œæœ›æœ‰ä¸€å¤©ï¼Œæˆ‘å¯ä»¥ä¸å¿µä»–äººï¼Œåªé—®å†…å¿ƒï¼Œåœ¨æˆ‘çš„ä¸–ç•Œé‡Œæ‚ æ¸¸è‡ªåœ¨ã€‚!heyæˆ‘çš„ä¸–ç•Œé‡Œæœ‰å¾ˆå¤šäººæ¥æ¥å¾€å¾€ï¼Œæœ‰çš„äººæ¨ç€æˆ‘å‰è¿›ï¼Œæœ‰çš„äººé˜»ç¢æˆ‘çš„è„šæ­¥ï¼Œæœ‰çš„äººå†·æ¼ æ—è§‚ã€‚æˆ‘å¸Œæœ›æœ‰ä¸€å¤©ï¼Œæˆ‘å¯ä»¥ä¸å¿µä»–äººï¼Œåªé—®å†…å¿ƒï¼Œåœ¨æˆ‘çš„ä¸–ç•Œé‡Œæ‚ æ¸¸è‡ªåœ¨ã€‚!!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"æˆ‘çš„ä¸–ç•Œé‡Œæœ‰å¾ˆå¤šäººæ¥æ¥å¾€å¾€ï¼Œæœ‰çš„äººæ¨ç€æˆ‘å‰è¿›ï¼Œæœ‰çš„äººé˜»ç¢æˆ‘çš„è„šæ­¥ï¼Œæœ‰çš„äººå†·æ¼ æ—è§‚ã€‚æˆ‘å¸Œæœ›æœ‰ä¸€å¤©ï¼Œæˆ‘å¯ä»¥ä¸å¿µä»–äººï¼Œåªé—®å†…å¿ƒï¼Œåœ¨æˆ‘çš„ä¸–ç•Œé‡Œæ‚ æ¸¸è‡ªåœ¨ã€‚hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:13.180470004 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:36.981394159 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:25:57.275809383 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:26:09.940822053 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-28 20:28:26.518553174 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-30 16:05:12.925570908 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-30 16:05:12.925570908 +0800 HKT","Text":"hey!"},{"UserID":"12330285","Date":"2015-04-30 16:05:12.925570908 +0800 HKT","Text":"hey!"}]}];
//var data = [{"QuestionNo":"2","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 16:34:08.063578878 +0800 HKT","Text":"å­™ä½³è¯šSBå—ï¼Ÿ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 16:37:19.552946764 +0800 HKT","Text":"æ˜¯çš„"},{"UserID":"12330285","Date":"2015-06-17 20:34:55.207520348 +0800 HKT","Text":"å‡ å°†è®¡å°±è®¡"}]},{"QuestionNo":"3","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 16:34:18.114142372 +0800 HKT","Text":"å­™ä½³è¯šç‰›é€¼å—ï¼Ÿ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 16:37:24.917421986 +0800 HKT","Text":"æ˜¯çš„"},{"UserID":"12330285","Date":"2015-06-17 20:29:16.456873357 +0800 HKT","Text":"ffjjfjfjf"}]},{"QuestionNo":"4","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 16:36:49.103988058 +0800 HKT","Text":"å­™ä½³è¯šäºŒé€¼å—ï¼Ÿ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 20:32:47.917100601 +0800 HKT","Text":"å“¦å¯å£å¯ä¹äº†"}]},{"QuestionNo":"5","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 19:56:17.072871581 +0800 HKT","Text":"å‘µå‘µ"},"Anwser":[]},{"QuestionNo":"6","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 20:05:47.366269221 +0800 HKT","Text":"å‘µå‘µ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 20:33:56.708773384 +0800 HKT","Text":"é¼“åŠ±é¼“åŠ±"}]},{"QuestionNo":"7","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 20:05:58.442973939 +0800 HKT","Text":"ingé‚£å¯èƒ½äº†æ˜æ˜"},"Anwser":[]},{"QuestionNo":"1","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 16:33:49.208581142 +0800 HKT","Text":"å­™ä½³è¯šé€—æ¯”å—ï¼Ÿ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 16:37:14.14000612 +0800 HKT","Text":"æ˜¯çš„"},{"UserID":"12330285","Date":"2015-06-17 20:34:04.972141345 +0800 HKT","Text":"è¯¥åŸºé‡‘"},{"UserID":"12330285","Date":"2015-06-17 20:34:19.03033494 +0800 HKT","Text":"äº†1ä½ ä¼°è®¡ğŸ˜"},{"UserID":"12330285","Date":"2015-06-17 20:34:38.913382598 +0800 HKT","Text":"è¿˜å’¯å’¯"}]},{"QuestionNo":"8","Reply":{"UserID":"","Date":"","Text":""},"Ask":{"UserID":"12330285","Date":"2015-06-17 20:35:11.093039353 +0800 HKT","Text":"çœ‹å¾—åˆ°å—ï¼Ÿ"},"Anwser":[{"UserID":"12330285","Date":"2015-06-17 20:35:29.048163896 +0800 HKT","Text":"''åˆšåˆšå¥½"},{"UserID":"12330285","Date":"2015-06-17 20:53:44.535559813 +0800 HKT","Text":"çš„ç‚¹ç‚¹æ»´æ»´\n"}]}];

var currPage = 0;
var answer = data[0].Anwser;
var maxPage = 0;
var QNO;
var UID;
var PWD;
var CID;
var CTN;
window.onload=function()//ç”¨windowçš„onloadäº‹ä»¶ï¼Œçª—ä½“åŠ è½½å®Œæ¯•çš„æ—¶å€™
{
	var Request = new Object();
	var url = location.search; //è·å–urlä¸­"?"ç¬¦åçš„å­—ä¸²
    var Request = new Object();
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for(var i = 0; i < strs.length; i ++) {
        	Request[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
        }
    }
	QNO = Request["no"];
	UID = $.cookie("UserID");
	PWD = $.cookie("Password");
	CID = $.cookie("CourseID");
	CTN = $.cookie("ChapterNo");
	$.ajax({
		url : '/api',
		type : 'POST',
		data : {
			'Action' : "LISTQ",
			'UserID' : UID,
			'Password' : PWD,
			'CourseID' : CID,
			//'ChapterNo' : CTN,
		},
	}).done(function(Data) {
		console.log(Data);
		data = JSON.parse(Data);
		answer =data[QNO].Anwser;
		if(answer.length % 15 > 0)
		{
			maxPage =  Math.ceil(answer.length/15);
		}
		else
			maxPage = answer.length / 15;
		if(Request["flag"]==1){
			currPage = maxPage-1;
		}
		$("#question").text(data[data.length - QNO + 1].Ask.Text);
		$("#asker_date").text("(By " +ã€€data[0].Ask.UserID + "  "+  data[0].Ask.Date.substr(0,19)ã€€+ ")");
		$("#maxPage").text("å…±" + maxPage + "é¡µ");
		for(var i = 0; i < 15; i++){
		    var userId = "user"+i;
		    var answerId = "answer"+i;
		    var liid = "comment" + i;
		    $("#comment").append("<li id=" + liid + " + class = " + "list-group-item" + "> </li>");
		    $("#" + liid).append("<dl><dt id= " + userId + "></dt><dd><pre id="+ answerId +"></pre></dd></dl>");
		    $("#" + liid).css("display","none");
		    $("#" + answerId).addClass("textStyle");
		}
		for(var i = 0; i < answer.length && i < i * currPage + 15 ; i++){

			var head = answer[i].UserID + " (" + answer[i].Date.substr(0,19) + ")";
			$("#user" + i).text(head);
			$("#answer" + i).text(answer[i].Text);
		    $("#comment" + i).css("display","block");
		}
		if(Request["flag"]==1){
			$("#currPage").text("ç¬¬" + (currPage+1) + "é¡µ");
			currPage++;
			lastPage();
			window.scrollTo(0,document.body.scrollHeight);//æ»šåŠ¨åˆ°åº•éƒ¨
		}
	});
	
}

function lastPage(){
	if(currPage == 0){
		return;
	}
	currPage--;
	for(var i = 0; i < 15; i++){
		$("#comment" + i).css("display","none");
	}
	javascript:scroll(0,0)
	for(var i = currPage * 15; i < answer.length && i < 15 * currPage + 15 ; i++){
		var head = answer[i].UserID + " (" + answer[i].Date.substr(0,19) + ")";
		$("#user" + i%15).text(head);
		$("#answer" + i%15).text(answer[i].Text);
		$("#comment" + i%15).css("display","block");
	}
	$("#currPage").text("  ç¬¬" + (currPage+1) + "é¡µ  ");
}
function nextPage(){
	if(currPage + 1 >= maxPage)
		return;
	currPage++;
	javascript:scroll(0,0)
	for(var i = 0; i < 15; i++){
			$("#comment" + i).css("display","none");
	}
	for(var i = currPage * 15; i < answer.length && i < 15 * currPage + 15 ; i++){
		var head = answer[i].UserID + " (" + answer[i].Date.substr(0,19) + ")";
		$("#user" + i%15).text(head);
		$("#answer" + i%15).text(answer[i].Text);
	    $("#comment" + i%15).css("display","block");
	}
	$("#currPage").text("ç¬¬" + (currPage+1) + "é¡µ");
}
function skipToPage(){
	var page = $("#skipTo").val();
	var re = /^[1-9][0-9]*$/;
	if(re.test(page)){
		pa = parseInt(page);
		if(pa > maxPage){
			alert("è¾“å…¥è¶…è¿‡æœ€å¤§é¡µæ•°");
			$("#skipTo").text("");
			return;
		}
		currPage = pa - 1;
		for(var i = 0; i < 15; i++){
		    $("#comment" + i).css("display","none");
		}
		javascript:scroll(0,0)
		for(var i = currPage * 15; i < answer.length && i < 15 * currPage + 15 ; i++){
			var head = answer[i].UserID + "(" + answer[i].Date.substr(0,19) + ")";
			$("#user" + i%15).text(head);
			$("#answer" + i%15).text(answer[i].Text);
		    $("#comment" + i%15).css("display","block");
		}
		$("#currPage").text("ç¬¬" + (currPage+1) + "é¡µ");
	}
	else{
		alert("è¾“å…¥ä¸åˆæ³•ï¼Œåªèƒ½åŒ…å«æ­£æ•°");
	}
	$("#skipTo").text("");
}

function answering(){
	//location.href ="qa.html?no="+QNO + "&flag=1";
	$("#divdiv").css("display","none");
	$.ajax({
		url : '/api',
		type : 'POST',
		data : {
			'Action' : "ANWSER",
			'UserID':UID,
			'Password':PWD,
			'CourseID' : CID,
			'QuestionNo' : QNO,
			'Body' : $("#myreply").val(),
		},
		statusCode: {
		    200: function() {
		    	location.href ="qa.html?no="+QNO;
		    }
		}
	}).done(function(Data) {
		console.log(Data);
	});
}